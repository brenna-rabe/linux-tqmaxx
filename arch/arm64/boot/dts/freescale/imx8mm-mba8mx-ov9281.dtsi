// SPDX-License-Identifier: (GPL-2.0-or-later OR MIT)
/*
 * Copyright 2021-2023 TQ-Systems GmbH <linux@ew.tq-group.com>,
 * D-82229 Seefeld, Germany.
 * Author: Alexander Stein
 */

/ {
	sensor_clk: sensor-clk {
		#clock-cells = <0>;
		compatible = "fixed-clock";
		clock-frequency = <24000000>;
	};
};

&csi1_bridge {
	fsl,mipi-mode;
	status = "okay";

	port {
		csi1_ep: endpoint {
			remote-endpoint = <&csi1_mipi_ep>;
		};
	};
};

&mipi_csi_1 {
	#address-cells = <1>;
	#size-cells = <0>;
	status = "okay";

	port {
		mipi1_sensor_ep: endpoint@1 {
			remote-endpoint = <&ov9281_ep0>;
			data-lanes = <2>;
			csis-hs-settle = <13>;
			csis-clk-settle = <2>;
			csis-wclk;
		};

		csi1_mipi_ep: endpoint@2 {
			remote-endpoint = <&csi1_ep>;
		};
	};
};

&i2c3 {
	vc_fpga: fpga@10 {
		reg = <0x10>;
		compatible = "vc,fpga";

		vc_fpga_reg: regulator {
			regulator-name = "CAM_VCC";
		};

		vc_fpga_reset: reset {
			#reset-cells = <0>;
		};

		vc_fpga_gpio: gpio-chip {
			gpio-controller;
			#gpio-cells = <2>;
		};
	};

	ov9281: camera@60 {
		#address-cells = <0x1>;
		#size-cells = <0x0>;
		reg = <0x60>;

		compatible = "ovti,ov9281";

		clock-names = "xvclk";
		clocks = <&sensor_clk>;

		avdd-supply = <&vc_fpga_reg>;
		dovdd-supply = <&vc_fpga_reg>;
		dvdd-supply = <&vc_fpga_reg>;

		/* NOTE: driver implements a wrong logic! */
		reset-gpios = <&vc_fpga_gpio 0 GPIO_ACTIVE_LOW>;

		port@0 {
			reg = <0>;

			ov9281_ep0: endpoint {
				remote-endpoint = <&mipi1_sensor_ep>;
				data-lanes = <1 2>;
				clock-lanes = <0>;
				clock-noncontinuous = <1>;
				link-frequencies = /bits/ 64 <400000000>;
			};
		};
	};
};

&mipi_csi_1 {
	status = "okay";

	// https://community.nxp.com/t5/i-MX-Processors/Fixing-base-address-switching-Change-Err-which-occurs-randomly/m-p/902311
	assigned-clock-rates = <
		200000000			/* > mipi bandwidth/8 */
		333000000			/* > pixclk */
		66000000
	>;
};
