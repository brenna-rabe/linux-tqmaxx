/*
 * Copyright 2016 Marco Felsch, TQ Systems GmbH
 *
 * The code contained herein is licensed under the GNU General Public
 * License. You may obtain a copy of the GNU General Public License
 * Version 2 or later at the following locations:
 *
 * http://www.opensource.org/licenses/gpl-license.html
 * http://www.gnu.org/copyleft/gpl.html
 */

#include <dt-bindings/input/input.h>
#include "imx6ul.dtsi"

/ {
	model = "TQMa6ULxL SOM";

	memory {
		reg = <0x80000000 0x10000000>;
	};

	usdhc2_pwrseq: emmc_pwrseq {
		compatible = "mmc-pwrseq-emmc";
		reset-gpios = <&gpio4 10 GPIO_ACTIVE_LOW>;
	};

	regulators_tqma6ul {
		compatible = "simple-bus";
		#address-cells = <1>;
		#size-cells = <0>;

		reg_tqma6ul_3v3: regulator@0 {
			compatible = "regulator-fixed";
			regulator-name = "supply-tqma6ul-3v3";
			reg = <0>;
			regulator-min-microvolt = <3300000>;
			regulator-max-microvolt = <3300000>;
			regulator-always-on;
		};
	};
};

&cpu0 {
	arm-supply = <&reg_arm>;
	soc-supply = <&reg_soc>;
	fsl,arm-soc-shared = <0>;
};

&gpc {
	fsl,ldo-bypass = <0>;
};

&i2c4 {
	clock-frequency = <100000>;
	pinctrl-names = "default";
	pinctrl-0 = <&pinctrl_i2c4>;
	status = "okay";

	pmic: pfuze3000@08 {
		compatible = "fsl,pfuze3000";
		reg = <0x08>;
		pinctrl-names = "default";
		pinctrl-0 = <&pinctrl_pmic>;
		/* TODO: add interrupts */

		regulators {
			reg_sw1a: sw1a {
				regulator-min-microvolt = <700000>;
				regulator-max-microvolt = <1475000>;
				regulator-boot-on;
				regulator-ramp-delay = <6250>;
				/* not used */
			};

			reg_sw1b_core: sw1b {
				regulator-min-microvolt = <700000>;
				regulator-max-microvolt = <1475000>;
				regulator-boot-on;
				regulator-always-on;
				regulator-ramp-delay = <6250>;
			};

			reg_sw2: sw2 {
				regulator-min-microvolt = <2500000>;
				regulator-max-microvolt = <3300000>;
				regulator-boot-on;
			};

			reg_sw3_ddr: sw3 {
				regulator-min-microvolt = <900000>;
				regulator-max-microvolt = <1650000>;
				regulator-boot-on;
				regulator-always-on;
			};

			reg_swbst: swbst {
				regulator-min-microvolt = <5000000>;
				regulator-max-microvolt = <5150000>;
				/* not used */
			};

			reg_snvs_3v0: vsnvs {
				regulator-min-microvolt = <1000000>;
				regulator-max-microvolt = <3000000>;
				regulator-boot-on;
				regulator-always-on;
			};

			reg_vrefddr: vrefddr {
				regulator-boot-on;
				regulator-always-on;
			};

			reg_vccsd: vccsd {
				regulator-min-microvolt = <2850000>;
				regulator-max-microvolt = <3300000>;
			};

			reg_v33_3v3: v33 {
				regulator-min-microvolt = <2850000>;
				regulator-max-microvolt = <3300000>;
				regulator-always-on;
			};

			reg_vldo1_3v3: vldo1 {
				regulator-min-microvolt = <1800000>;
				regulator-max-microvolt = <3300000>;
				/* not used */
			};

			reg_vldo2: vldo2 {
				regulator-min-microvolt = <800000>;
				regulator-max-microvolt = <1550000>;
				/* not used */
			};

			reg_vldo3: vldo3 {
				regulator-min-microvolt = <1800000>;
				regulator-max-microvolt = <3300000>;
				regulator-always-on;
			};

			reg_vldo4: vldo4 {
				regulator-min-microvolt = <1800000>;
				regulator-max-microvolt = <3300000>;
				regulator-always-on;
			};
		};
	};

	/*
	 * NXP SE97BTP with temperature sensor + eeprom
	 * ATTENTION: do not use correct dt compatible since this will conflict
	 * with hwmon sysfs ABI and break device registration
	 */
	temp0: jc42@1a {
		compatible = "jc42";
		reg = <0x1a>;
		status = "okay";
	};

	eeprom0: 24c64@50 {
		compatible = "atmel,24c64";
		reg = <0x50>;
		pagesize = <32>;
		status = "okay";
	};

	eeprom1: 24c02@52 {
		compatible = "atmel,24c02";
		reg = <0x52>;
		pagesize = <16>;
		status = "okay";
	};

	rtc1: ds1339@68 {
		compatible = "ds1339";
		reg = <0x68>;
		status = "okay";
	};
};

&iomuxc {
	imx6ul-tqma6ul {
		pinctrl_i2c4: i2c4grp {
			fsl,pins = <
				MX6UL_PAD_UART2_TX_DATA__I2C4_SCL	0x4001b8b0
				MX6UL_PAD_UART2_RX_DATA__I2C4_SDA	0x4001b8b0
			>;
		};

		pinctrl_pmic: pmic {
			fsl,pins = <
				/* PMIC irq */
				MX6UL_PAD_CSI_DATA03__GPIO4_IO24	0x1b099
			>;
		};

		pinctrl_qspi: qspigrp {
			fsl,pins = <
				MX6UL_PAD_NAND_WP_B__QSPI_A_SCLK      0x70a1
				MX6UL_PAD_NAND_READY_B__QSPI_A_DATA00 0x70b9
				MX6UL_PAD_NAND_CE0_B__QSPI_A_DATA01   0x70b9
				MX6UL_PAD_NAND_CE1_B__QSPI_A_DATA02   0x70b9
				MX6UL_PAD_NAND_CLE__QSPI_A_DATA03     0x70b9
				MX6UL_PAD_NAND_DQS__QSPI_A_SS0_B      0x70a1
			>;
		};

		pinctrl_usdhc2: usdhc2grp {
			fsl,pins = <
				MX6UL_PAD_NAND_RE_B__USDHC2_CLK		0x00010059
				MX6UL_PAD_NAND_WE_B__USDHC2_CMD		0x00017051
				MX6UL_PAD_NAND_DATA00__USDHC2_DATA0	0x00017059
				MX6UL_PAD_NAND_DATA01__USDHC2_DATA1	0x00017059
				MX6UL_PAD_NAND_DATA02__USDHC2_DATA2	0x00017059
				MX6UL_PAD_NAND_DATA03__USDHC2_DATA3	0x00017059
				MX6UL_PAD_NAND_DATA04__USDHC2_DATA4	0x00017059
				MX6UL_PAD_NAND_DATA05__USDHC2_DATA5	0x00017059
				MX6UL_PAD_NAND_DATA06__USDHC2_DATA6	0x00017059
				MX6UL_PAD_NAND_DATA07__USDHC2_DATA7	0x00017059
				/* rst */
				MX6UL_PAD_NAND_ALE__GPIO4_IO10		0x0001b099
			>;
		};
	};
};

&qspi {
	pinctrl-names = "default";
	pinctrl-0 = <&pinctrl_qspi>;
	status = "okay";

	flash0: n25q512ax3@0 {
		#address-cells = <1>;
		#size-cells = <1>;
		compatible = "micron,n25q512ax3";
		spi-max-frequency = <29000000>;
		reg = <0>;
	};
};

/* eMMC */
&usdhc2 {
	pinctrl-names = "default";
	pinctrl-0 = <&pinctrl_usdhc2>;

	vmmc-supply = <&reg_tqma6ul_3v3>;
	vqmmc-supply = <&reg_tqma6ul_3v3>;

	bus-width = <8>;
	disable-wp;
	non-removable;
	no-1-8-v;
	mmc-pwrseq = <&usdhc2_pwrseq>;
	status = "okay";
};
